# Neorem - Validation Rules

**Phase 2: Core Data Model**

Property Management System

**Format:** Field | Validation Rules | Error Messages

All validations should be enforced at both database and application level

## 1. Portfolio Validations

### name

- **Required:** Yes
- **Type:** String
- **Min Length:** 1 character
- **Max Length:** 255 characters
- **Pattern:** Any printable characters
- **Error:** "Portfolio name is required and must be between 1 and 255 characters"

### code

- **Required:** No
- **Type:** String
- **Max Length:** 50 characters
- **Pattern:** Alphanumeric, hyphens, underscores only
- **Unique:** Yes (per organization)
- **Error:** "Portfolio code must be alphanumeric and maximum 50 characters"

### status

- **Required:** Yes
- **Type:** Enum
- **Values:** 'active', 'inactive', 'archived'
- **Default:** 'active'
- **Error:** "Status must be one of: active, inactive, archived"

### owner_id

- **Required:** Yes
- **Type:** Integer (Foreign Key)
- **Must exist in users table**
- **User must be active**
- **Error:** "Valid owner is required"

## 2. Property Validations

### name

- **Required:** Yes
- **Type:** String
- **Min Length:** 1 character
- **Max Length:** 255 characters
- **Error:** "Property name is required and must be between 1 and 255 characters"

### address_line1

- **Required:** Yes
- **Type:** String
- **Min Length:** 1 character
- **Max Length:** 255 characters
- **Error:** "Address line 1 is required"

### city

- **Required:** Yes
- **Type:** String
- **Min Length:** 1 character
- **Max Length:** 100 characters
- **Pattern:** Letters, spaces, hyphens, apostrophes
- **Error:** "City is required and must be valid"

### state

- **Required:** Yes
- **Type:** String
- **Min Length:** 1 character
- **Max Length:** 100 characters
- **Error:** "State is required"

### postal_code

- **Required:** Yes
- **Type:** String
- **Min Length:** 5 characters
- **Max Length:** 20 characters
- **Pattern:** Alphanumeric, hyphens, spaces
- **Examples:** "12345", "12345-6789", "SW1A 1AA" (UK)
- **Error:** "Postal code must be between 5 and 20 characters"

### country

- **Required:** Yes
- **Type:** String
- **Default:** 'USA'
- **Max Length:** 100 characters
- **Error:** "Country is required"

### latitude

- **Required:** No
- **Type:** Decimal
- **Range:** -90.0 to 90.0
- **Precision:** 8 decimal places
- **Error:** "Latitude must be between -90 and 90"

### longitude

- **Required:** No
- **Type:** Decimal
- **Range:** -180.0 to 180.0
- **Precision:** 8 decimal places
- **Error:** "Longitude must be between -180 and 180"

### property_type

- **Required:** Yes
- **Type:** Enum
- **Values:** 'residential', 'commercial', 'mixed-use', 'industrial'
- **Error:** "Property type must be one of: residential, commercial, mixed-use, industrial"

### status

- **Required:** Yes
- **Type:** Enum
- **Values:** 'active', 'inactive', 'renovation', 'for_sale', 'sold'
- **Default:** 'active'
- **Error:** "Status must be one of: active, inactive, renovation, for_sale, sold"

### year_built

- **Required:** No
- **Type:** Year
- **Range:** 1800 to current year
- **Error:** "Year built must be between 1800 and current year"

### total_sqft

- **Required:** No
- **Type:** Decimal
- **Min:** 0
- **Max:** 9999999999.99
- **Precision:** 2 decimal places
- **Error:** "Total square footage must be a positive number"

### total_units

- **Required:** No
- **Type:** Integer
- **Min:** 0
- **Max:** 99999
- **Error:** "Total units must be between 0 and 99999"

## 3. Unit Validations

### unit_number

- **Required:** Yes
- **Type:** String
- **Min Length:** 1 character
- **Max Length:** 50 characters
- **Pattern:** Alphanumeric, hyphens, underscores, spaces
- **Unique:** Yes (per property)
- **Error:** "Unit number is required and must be unique within the property"

### unit_type

- **Required:** Yes
- **Type:** Enum
- **Values:** 'residential', 'commercial', 'common', 'amenity', 'utility', 'parking', 'storage'
- **Error:** "Unit type must be one of: residential, commercial, common, amenity, utility, parking, storage"

### bedrooms

- **Required:** No
- **Type:** Integer
- **Min:** 0
- **Max:** 20
- **Error:** "Bedrooms must be between 0 and 20"

### bathrooms

- **Required:** No
- **Type:** Decimal
- **Min:** 0
- **Max:** 99.9
- **Precision:** 1 decimal place
- **Error:** "Bathrooms must be between 0 and 99.9"

### half_baths

- **Required:** No
- **Type:** Integer
- **Min:** 0
- **Max:** 10
- **Error:** "Half baths must be between 0 and 10"

### sqft

- **Required:** No
- **Type:** Decimal
- **Min:** 0
- **Max:** 9999999.99
- **Precision:** 2 decimal places
- **Error:** "Square footage must be a positive number"

### rentable_sqft

- **Required:** No
- **Type:** Decimal
- **Min:** 0
- **Max:** 9999999.99
- **Precision:** 2 decimal places
- **Business Rule:** `rentable_sqft` <= `sqft` (if both provided)
- **Error:** "Rentable square footage must be less than or equal to total square footage"

### status

- **Required:** Yes
- **Type:** Enum
- **Values:** 'available', 'occupied', 'reserved', 'maintenance', 'unavailable', 'off_market'
- **Default:** 'available'
- **Error:** "Status must be one of: available, occupied, reserved, maintenance, unavailable, off_market"

### market_rent_amount

- **Required:** No
- **Type:** Decimal
- **Min:** 0
- **Max:** 9999999.99
- **Precision:** 2 decimal places
- **Error:** "Market rent amount must be a positive number"

### current_rent_amount

- **Required:** No
- **Type:** Decimal
- **Min:** 0
- **Max:** 9999999.99
- **Precision:** 2 decimal places
- **Error:** "Current rent amount must be a positive number"

## 4. Tenant Validations

### full_name

- **Required:** Yes
- **Type:** String
- **Min Length:** 1 character
- **Max Length:** 255 characters
- **Pattern:** Letters, spaces, hyphens, apostrophes, periods
- **Error:** "Full name is required and must be between 1 and 255 characters"

### email

- **Required:** Yes
- **Type:** String
- **Max Length:** 255 characters
- **Pattern:** Valid email format (RFC 5322 compliant)
- **Unique:** Yes (per organization)
- **Examples:** "user@example.com", "first.last@company.co.uk"
- **Error:** "Valid email address is required and must be unique"

### phone

- **Required:** Yes
- **Type:** String
- **Min Length:** 10 characters
- **Max Length:** 20 characters
- **Pattern:** Digits, spaces, hyphens, parentheses, plus sign
- **Examples:** "+1-555-123-4567", "(555) 123-4567", "5551234567"
- **Error:** "Phone number is required and must be between 10 and 20 characters"

### phone_secondary

- **Required:** No
- **Type:** String
- **Max Length:** 20 characters
- **Pattern:** Same as phone
- **Error:** "Secondary phone must be valid format"

### date_of_birth

- **Required:** No
- **Type:** Date
- **Format:** YYYY-MM-DD
- **Business Rule:** Age >= 18 for residential tenants (enforced at application level)
- **Error:** "Date of birth must be a valid date"

### ssn

- **Required:** No
- **Type:** String
- **Length:** 11 characters (with hyphens) or 9 characters (without)
- **Pattern:** XXX-XX-XXXX or XXXXXXXXX
- **Encrypted:** Yes (at rest)
- **Error:** "SSN must be in format XXX-XX-XXXX"

### tax_id

- **Required:** No
- **Type:** String
- **Max Length:** 50 characters
- **Pattern:** Alphanumeric
- **Encrypted:** Yes (at rest)
- **Error:** "Tax ID must be alphanumeric and maximum 50 characters"

### type

- **Required:** Yes
- **Type:** Enum
- **Values:** 'residential', 'commercial', 'corporate'
- **Error:** "Tenant type must be one of: residential, commercial, corporate"

### status

- **Required:** Yes
- **Type:** Enum
- **Values:** 'prospect', 'active', 'former', 'blacklisted'
- **Default:** 'prospect'
- **Error:** "Status must be one of: prospect, active, former, blacklisted"

## 5. Lease Validations

### start_date

- **Required:** Yes
- **Type:** Date
- **Format:** YYYY-MM-DD
- **Business Rule:** `start_date` <= `end_date`
- **Business Rule:** `start_date` >= current date (for new leases)
- **Error:** "Start date is required and must be before or equal to end date"

### end_date

- **Required:** Yes
- **Type:** Date
- **Format:** YYYY-MM-DD
- **Business Rule:** `end_date` >= `start_date`
- **Business Rule:** `end_date` > `start_date` (lease must have duration)
- **Error:** "End date is required and must be after start date"

### rent_amount

- **Required:** Yes
- **Type:** Decimal
- **Min:** 0
- **Max:** 9999999.99
- **Precision:** 2 decimal places
- **Error:** "Rent amount is required and must be a positive number"

### deposit_amount

- **Required:** No
- **Type:** Decimal
- **Min:** 0
- **Max:** 9999999.99
- **Precision:** 2 decimal places
- **Error:** "Deposit amount must be a positive number"

### pet_deposit_amount

- **Required:** No
- **Type:** Decimal
- **Min:** 0
- **Max:** 9999999.99
- **Precision:** 2 decimal places
- **Error:** "Pet deposit amount must be a positive number"

### status

- **Required:** Yes
- **Type:** Enum
- **Values:** 'draft', 'pending_signature', 'active', 'expired', 'terminated', 'renewed'
- **Default:** 'draft'
- **Error:** "Status must be one of: draft, pending_signature, active, expired, terminated, renewed"

### billing_cycle

- **Required:** Yes
- **Type:** Enum
- **Values:** 'monthly', 'weekly', 'biweekly', 'quarterly', 'yearly'
- **Default:** 'monthly'
- **Error:** "Billing cycle must be one of: monthly, weekly, biweekly, quarterly, yearly"

### payment_due_day

- **Required:** Yes
- **Type:** Integer
- **Business Rule:** If `billing_cycle` = 'monthly', range: 1-31
- **Business Rule:** If `billing_cycle` = 'weekly', range: 1-7 (1=Monday, 7=Sunday)
- **Business Rule:** If `billing_cycle` = 'biweekly', range: 1-14
- **Error:** "Payment due day must be valid for the selected billing cycle"

### late_fee_amount

- **Required:** No
- **Type:** Decimal
- **Min:** 0
- **Max:** 9999999.99
- **Precision:** 2 decimal places
- **Error:** "Late fee amount must be a positive number"

### late_fee_percentage

- **Required:** No
- **Type:** Decimal
- **Min:** 0
- **Max:** 100.00
- **Precision:** 2 decimal places
- **Error:** "Late fee percentage must be between 0 and 100"

### Business Rules (Application Level)

- Unit can have only one active lease at a time
- Lease dates cannot overlap with existing active lease for same unit
- Rent amount should match unit's `current_rent_amount` (warning, not error)

## 6. Payment Validations

### amount

- **Required:** Yes
- **Type:** Decimal
- **Min:** 0.01
- **Max:** 9999999.99
- **Precision:** 2 decimal places
- **Error:** "Payment amount must be at least $0.01"

### currency

- **Required:** Yes
- **Type:** String
- **Length:** 3 characters
- **Pattern:** ISO 4217 currency code (e.g., USD, EUR, GBP)
- **Default:** 'USD'
- **Error:** "Currency must be a valid ISO 4217 code"

### due_date

- **Required:** Yes
- **Type:** Date
- **Format:** YYYY-MM-DD
- **Error:** "Due date is required and must be a valid date"

### status

- **Required:** Yes
- **Type:** Enum
- **Values:** 'pending', 'paid', 'partial', 'failed', 'refunded', 'voided'
- **Default:** 'pending'
- **Error:** "Status must be one of: pending, paid, partial, failed, refunded, voided"

### payment_type

- **Required:** Yes
- **Type:** Enum
- **Values:** 'rent', 'deposit', 'late_fee', 'other'
- **Error:** "Payment type must be one of: rent, deposit, late_fee, other"

### method

- **Required:** No
- **Type:** Enum
- **Values:** 'card', 'ach', 'cash', 'check', 'money_order', 'other'
- **Error:** "Payment method must be one of: card, ach, cash, check, money_order, other"

### transaction_id

- **Required:** No
- **Type:** String
- **Max Length:** 255 characters
- **Pattern:** Alphanumeric, hyphens, underscores
- **Error:** "Transaction ID must be maximum 255 characters"

### receipt_number

- **Required:** No
- **Type:** String
- **Max Length:** 50 characters
- **Pattern:** Alphanumeric, hyphens, underscores
- **Unique:** Yes (globally)
- **Error:** "Receipt number must be unique and maximum 50 characters"

### Business Rules (Application Level)

- Payment must belong to an active lease
- Payment amount should match lease `rent_amount` for rent payments
- Partial payments: sum of partial payments <= total due amount

## 7. Work Order Validations

### title

- **Required:** Yes
- **Type:** String
- **Min Length:** 1 character
- **Max Length:** 255 characters
- **Error:** "Title is required and must be between 1 and 255 characters"

### description

- **Required:** Yes
- **Type:** String
- **Min Length:** 1 character
- **Max Length:** 10000 characters
- **Error:** "Description is required and must be between 1 and 10000 characters"

### priority

- **Required:** Yes
- **Type:** Enum
- **Values:** 'emergency', 'urgent', 'routine', 'cosmetic'
- **Default:** 'routine'
- **Error:** "Priority must be one of: emergency, urgent, routine, cosmetic"

### status

- **Required:** Yes
- **Type:** Enum
- **Values:** 'draft', 'assigned', 'in_progress', 'completed', 'closed', 'cancelled'
- **Default:** 'draft'
- **Error:** "Status must be one of: draft, assigned, in_progress, completed, closed, cancelled"

### scheduled_date

- **Required:** No
- **Type:** Date
- **Format:** YYYY-MM-DD
- **Business Rule:** `scheduled_date` >= current date (for future scheduling)
- **Error:** "Scheduled date must be a valid date"

### cost_amount

- **Required:** No
- **Type:** Decimal
- **Min:** 0
- **Max:** 9999999.99
- **Precision:** 2 decimal places
- **Error:** "Cost amount must be a positive number"

### invoice_number

- **Required:** No
- **Type:** String
- **Max Length:** 50 characters
- **Pattern:** Alphanumeric, hyphens, underscores
- **Error:** "Invoice number must be maximum 50 characters"

### Business Rules (Application Level)

- Work order must have either `assigned_to_user_id` OR `assigned_to_vendor_id` (not both required, but at least one for 'assigned' status)
- `completed_at` must be set when status = 'completed'
- `cost_amount` should be set when status = 'completed' (warning, not error)

## 8. User Validations

### name

- **Required:** Yes
- **Type:** String
- **Min Length:** 1 character
- **Max Length:** 255 characters
- **Error:** "Name is required and must be between 1 and 255 characters"

### email

- **Required:** Yes
- **Type:** String
- **Max Length:** 255 characters
- **Pattern:** Valid email format (RFC 5322 compliant)
- **Unique:** Yes (per organization)
- **Error:** "Valid email address is required and must be unique within organization"

### phone

- **Required:** No
- **Type:** String
- **Max Length:** 20 characters
- **Pattern:** Digits, spaces, hyphens, parentheses, plus sign
- **Error:** "Phone must be valid format"

### password_hash

- **Required:** No (required if `auth_provider` = 'password')
- **Type:** String
- **Max Length:** 255 characters
- **Encrypted:** Yes (bcrypt or similar)
- **Business Rule:** Required if `auth_provider` = 'password'
- **Error:** "Password is required for password authentication"

### auth_provider

- **Required:** Yes
- **Type:** Enum
- **Values:** 'password', 'sso', 'oauth'
- **Default:** 'password'
- **Error:** "Auth provider must be one of: password, sso, oauth"

### status

- **Required:** Yes
- **Type:** Enum
- **Values:** 'active', 'inactive', 'suspended'
- **Default:** 'active'
- **Error:** "Status must be one of: active, inactive, suspended"

## 9. Role Validations

### name

- **Required:** Yes
- **Type:** String
- **Min Length:** 1 character
- **Max Length:** 100 characters
- **Error:** "Role name is required and must be between 1 and 100 characters"

### code

- **Required:** Yes
- **Type:** String
- **Max Length:** 50 characters
- **Pattern:** Lowercase alphanumeric with underscores only
- **Unique:** Yes (globally)
- **Examples:** "property_manager", "tenant", "super_admin"
- **Error:** "Role code must be unique, lowercase, alphanumeric with underscores only"

### is_system_role

- **Required:** Yes
- **Type:** Boolean
- **Default:** FALSE
- **Business Rule:** System roles cannot be deleted
- **Error:** "System role flag is required"

## 10. Cross-Entity Business Rules

### Portfolio → Property

- Property must belong to exactly one Portfolio
- Portfolio must exist and be active (for new properties)

### Property → Unit

- Unit must belong to exactly one Property
- Property must exist and be active (for new units)
- Unit number must be unique within Property

### Unit → Lease

- Unit can have only one active lease at a time
- Lease dates cannot overlap with existing active lease for same unit
- Unit status should be 'available' or 'reserved' before creating active lease

### Tenant → Lease

- Tenant can have multiple active leases (different units)
- Tenant must be 'active' status to create active lease

### Lease → Payment

- Payment must belong to an active lease
- Payment amount should match lease `rent_amount` for rent payments
- Payment `due_date` should align with lease `billing_cycle`

### Unit → Work Order

- Work order can be property-level (`unit_id` = NULL) or unit-level
- Unit must exist if `unit_id` is provided

### Maintenance Request → Work Order

- Work order can be created from maintenance request
- Maintenance request must exist if `maintenance_request_id` is provided

## 11. Data Format Specifications

### Email Format

- RFC 5322 compliant
- Pattern: `^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$`
- Examples: user@example.com, first.last@company.co.uk

### Phone Format

- International format supported
- Pattern: Digits, spaces, hyphens, parentheses, plus sign
- Examples: "+1-555-123-4567", "(555) 123-4567", "5551234567"
- Min length: 10 digits (after formatting)

### Date Format

- ISO 8601: YYYY-MM-DD
- Examples: "2024-01-15", "2024-12-31"

### Timestamp Format

- ISO 8601: YYYY-MM-DD HH:MM:SS
- Timezone: UTC (stored), converted to user timezone (displayed)
- Examples: "2024-01-15 14:30:00"

### Currency Format

- ISO 4217 currency codes
- Examples: USD, EUR, GBP, CAD
- Default: USD

### Decimal Precision

- Money amounts: 2 decimal places (DECIMAL(10, 2))
- Square footage: 2 decimal places (DECIMAL(10, 2))
- Percentages: 2 decimal places (DECIMAL(5, 2))
- Bathrooms: 1 decimal place (DECIMAL(3, 1))

## 12. Validation Enforcement Levels

### Database Level (Constraints)

- Primary keys, Foreign keys, Unique constraints
- Check constraints (MySQL 8.0.16+)
- Data type constraints
- NOT NULL constraints

### Application Level (Business Logic)

- Format validations (email, phone, dates)
- Business rules (date ranges, overlapping leases)
- Conditional validations (password required if `auth_provider` = 'password')
- Complex validations (unit can have only one active lease)

### Frontend Level (User Experience)

- Real-time validation feedback
- Format hints and examples
- Required field indicators
- Input masks (phone, SSN, dates)

## Summary

### Validation Categories

- Required fields
- Data types and formats
- Length constraints
- Range constraints
- Pattern matching
- Uniqueness constraints
- Business rules
- Cross-entity relationships

### Enforcement

- Database constraints for data integrity
- Application logic for business rules
- Frontend validation for user experience



