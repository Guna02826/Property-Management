# Neorem - Data Model & Entities

## 1) Core Entities (must-have attributes)

Marked: (R) required, (O) optional

### Portfolio

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `name` (R)
- `code/identifier` (O)
- `description` (O)
- `owner_id` (R) - Property Owner/Investor
- `portfolio_manager_id` (O) - Assigned Portfolio Manager
- `status` [active/inactive/archived] (R)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Property

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `portfolio_id` (R)
- `owner_id` (R) - Direct property owner
- `property_manager_id` (O) - Assigned Property Manager
- `name` (R)
- `code/identifier` (O)
- `address_line1` (R), `address_line2` (O), `city` (R), `state` (R), `postal_code` (R), `country` (R)
- `latitude` / `longitude` (O) - Geocoding
- `property_type` [residential/commercial/mixed-use/industrial] (R)
- `property_classification` (O) - Apartment complex, office building, etc.
- `status` [active/inactive/renovation/for_sale/sold] (R)
- `ownership_entity` (O)
- `tax_id` / `parcel_number` (O)
- `year_built` (O)
- `total_sqft` (O)
- `total_units` (O)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Unit

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `property_id` (R)
- `building_id` (O) - If building level exists
- `floor_id` (O) - If floor level exists
- `unit_number/name` (R)
- `unit_type` [residential/commercial/common/amenity/utility/parking/storage] (R)
- `residential_type` (O) - studio/1BR/2BR/3BR/etc. (if residential)
- `bedrooms` (O), `bathrooms` (O), `half_baths` (O)
- `sqft` (O)
- `rentable_sqft` (O)
- `status` [available/occupied/reserved/maintenance/unavailable/off_market] (R)
- `floor_number` (O)
- `market_rent_amount` (O)
- `current_rent_amount` (O)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Tenant

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `full_name` (R)
- `email` (R)
- `phone` (R)
- `phone_secondary` (O)
- `date_of_birth` (O)
- `ssn/tax_id` (O) - Encrypted
- `type` [residential/commercial/corporate] (R)
- `status` [prospect/active/former/blacklisted] (R)
- `current_address` (O)
- `emergency_contact_name` (O)
- `emergency_contact_phone` (O)
- `communication_preferences` (O)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Lease

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `unit_id` (R)
- `tenant_id` (R)
- `property_id` (R) - Denormalized for performance
- `start_date` (R)
- `end_date` (R)
- `rent_amount` (R)
- `deposit_amount` (O)
- `pet_deposit_amount` (O)
- `status` [draft/pending_signature/active/expired/terminated/renewed] (R)
- `billing_cycle` [monthly/weekly/biweekly/quarterly/yearly] (R)
- `payment_due_day` (R) - Day of month/week
- `late_fee_amount` (O)
- `late_fee_percentage` (O)
- `renewal_options` (O)
- `signed_at` (O) - E-signature completion
- `signed_by_tenant_at` (O)
- `signed_by_owner_at` (O)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Payment

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `lease_id` (R)
- `tenant_id` (R)
- `property_id` (R) - Denormalized
- `unit_id` (R) - Denormalized
- `amount` (R)
- `currency` (R) - Default USD
- `due_date` (R)
- `paid_at` (O)
- `status` [pending/paid/partial/failed/refunded/voided] (R)
- `payment_type` [rent/deposit/late_fee/other] (R)
- `method` [card/ach/cash/check/money_order/other] (O)
- `transaction_id` (O) - Payment gateway transaction ID
- `receipt_number` (O)
- `notes` (O)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Maintenance Request

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `property_id` (R)
- `unit_id` (O)
- `tenant_id` (R) - Who submitted
- `title` (R)
- `description` (R)
- `priority` [emergency/urgent/routine/cosmetic] (R)
- `status` [submitted/acknowledged/assigned/in_progress/completed/closed/cancelled] (R)
- `submitted_at` (R)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Work Order

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `maintenance_request_id` (O) - If created from request
- `property_id` (R)
- `unit_id` (O)
- `tenant_id` (O)
- `title/description` (R)
- `priority` [emergency/urgent/routine/cosmetic] (R)
- `status` [draft/assigned/in_progress/completed/closed/cancelled] (R)
- `assigned_to_user_id` (O) - Internal technician
- `assigned_to_vendor_id` (O) - External vendor
- `scheduled_date` (O)
- `completed_at` (O)
- `cost_amount` (O)
- `invoice_number` (O)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### User

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `name` (R)
- `email` (R) - Unique per organization
- `phone` (O)
- `password_hash` (O) - If using password auth
- `auth_provider` [password/sso/oauth] (R)
- `two_factor_enabled` (O)
- `two_factor_secret` (O)
- `status` [active/inactive/suspended] (R)
- `last_login_at` (O)
- `email_verified_at` (O)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Role

- `id` (R)
- `organization_id` (O) - Null for system roles, set for custom roles
- `name` (R)
- `code` (R) - Unique identifier (e.g., 'property_manager', 'tenant')
- `description` (O)
- `is_system_role` (R) - System-defined vs custom
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Permission

- `id` (R)
- `name` (R)
- `code` (R) - Unique identifier (e.g., 'property.create', 'lease.read')
- `resource_type` (R) - What resource (property, lease, payment, etc.)
- `action` (R) - What action (create, read, update, delete, approve)
- `description` (O)
- `created_at` / `updated_at` (R)

### Organization/Company

- `id` (R)
- `name` (R)
- `code/identifier` (R) - Unique identifier
- `type` [property_management_company/property_owner/individual] (R)
- `tax_id` (O)
- `address` (O)
- `phone` (O)
- `email` (O)
- `status` [active/inactive/suspended] (R)
- `subscription_tier` (O)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Vendor/Contractor

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `name` (R)
- `company_name` (O)
- `email` (R)
- `phone` (R)
- `service_categories` (O) - Array of service types
- `insurance_expiry` (O)
- `license_number` (O)
- `status` [active/inactive/blacklisted] (R)
- `rating` (O) - Average rating
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Document

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `name` (R)
- `file_name` (R)
- `file_path` (R)
- `file_size` (R)
- `mime_type` (R)
- `document_type` (R) - lease, invoice, photo, certificate, etc.
- `entity_type` (R) - What entity owns this (property, unit, lease, tenant, etc.)
- `entity_id` (R) - ID of owning entity
- `category` (O) - Further categorization
- `is_public` (R) - Can tenant access?
- `expires_at` (O)
- `uploaded_by` (R)
- `created_at` / `updated_at` (R)
- `deleted_at` (O) - Soft delete

### Entity Media

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `entity_type` (R) - What entity owns this (property, unit, lease, tenant, work_order, etc.)
- `entity_id` (R) - ID of owning entity
- `document_id` (O) - Reference to documents table if media is stored there
- `file_name` (O) - Original filename
- `file_path` (O) - GCS path to file (gs://bucket/path/to/file.jpg)
- `file_url` (O) - Public URL or signed URL for access
- `file_size` (O) - File size in bytes
- `mime_type` (O) - image/jpeg, image/png, video/mp4, etc.
- `media_type` (R) - image, video, document, other
- `title` (O) - User-friendly title/name
- `description` (O)
- `alt_text` (O) - For accessibility
- `display_order` (R) - Order for display (0 = first, 1 = second, etc.)
- `is_thumbnail` (R) - Is this the thumbnail for the entity?
- `is_primary` (R) - Is this the primary/featured media?
- `gallery_name` (O) - Group media into galleries (e.g., "exterior", "interior", "before", "after")
- `gallery_order` (O) - Order within the gallery
- `is_public` (R) - Can tenants/public access?
- `is_active` (R) - Is this media active/visible?
- `metadata` (O) - JSON for additional data (dimensions, tags, EXIF, etc.)
- `uploaded_by` (O)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Notification

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `user_id` (O) - Target user (null for tenant notifications)
- `tenant_id` (O) - Target tenant
- `type` (R) - rent_reminder, maintenance_update, lease_renewal, etc.
- `title` (R)
- `message` (R)
- `channel` [email/whatsapp/push/in_app] (R)
- `status` [pending/sent/failed/read] (R)
- `sent_at` (O)
- `read_at` (O)
- `metadata` (O) - JSON for additional data
- `created_at` / `updated_at` (R)

### Audit Log

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `user_id` (O) - Who performed action
- `action` (R) - create, update, delete, view, etc.
- `entity_type` (R) - What entity was affected
- `entity_id` (R) - ID of affected entity
- `changes` (O) - JSON of before/after values
- `ip_address` (O)
- `user_agent` (O)
- `created_at` (R)

### User-Property Assignment (Access Control)

- `id` (R)
- `user_id` (R)
- `property_id` (R)
- `portfolio_id` (O) - If assigned via portfolio
- `access_level` [full/read_only] (R)
- `assigned_at` (R)
- `assigned_by` (R)
- `expires_at` (O)
- `created_at` / `updated_at` (R)

### Sales Representative

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `user_id` (R) - Reference to User table
- `status` [active/inactive/on_leave] (R)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Property Visit

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `property_id` (R)
- `unit_id` (O)
- `sales_rep_id` (R)
- `client_id` (R) - Client interested in property
- `scheduled_date` (R)
- `scheduled_time` (R)
- `status` [scheduled/completed/cancelled/postponed] (R)
- `visit_type` [showing/inspection/follow_up] (O)
- `notes` (O)
- `outcome` (O) - JSON field for visit results
- `feedback` (O)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Sales Rep Leave

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `sales_rep_id` (R)
- `start_date` (R)
- `end_date` (R)
- `leave_type` [vacation/sick/personal/other] (R)
- `status` [approved/pending/cancelled] (R)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Client Property Interest

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `client_id` (R) - Reference to User or Tenant table
- `property_id` (R)
- `interest_level` [high/medium/low] (O)
- `notes` (O)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Canteen

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `property_id` (R)
- `name` (R)
- `capacity` (O)
- `status` [active/inactive] (R)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Canteen Agreement

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `canteen_id` (R)
- `client_id` (O) - If assigned to client
- `tenant_id` (O) - If assigned to tenant
- `agreement_type` [lease/contract] (R)
- `start_date` (R)
- `end_date` (O)
- `fee_amount` (O)
- `terms` (O) - JSON field for agreement terms
- `status` [active/expired/terminated] (R)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

### Parking Space

- `id` (R)
- `organization_id` (R) - Multi-tenant isolation
- `property_id` (R)
- `unit_id` (O) - If assigned to unit
- `client_id` (O) - If assigned to specific client
- `owner_id` (O) - If assigned to specific owner
- `space_number` (R)
- `parking_type` [covered/uncovered/garage/street] (R)
- `ev_charging` (O) - Boolean
- `accessibility_features` (O) - JSON array
- `status` [available/occupied/reserved] (R)
- `created_at` / `updated_at` (R)
- `created_by` / `updated_by` (R) - Audit fields
- `deleted_at` (O) - Soft delete

## 2) Entity Relationships (cardinality & joins)

### Core Hierarchy Relationships

- Organization 1..N Portfolios (`portfolio.organization_id`)
- Organization 1..N Properties (`property.organization_id`)
- Organization 1..N Users (`user.organization_id`)
- Portfolio 1..N Properties (`property.portfolio_id`)
- Portfolio N..M Properties via `portfolio_properties` (if multi-portfolio assignment) [Later]
- Property 1..N Units (`unit.property_id`)
- Property 0..1 Building (`building.property_id`) [Optional]
- Building 1..N Floors (`floor.building_id`) [Optional]
- Floor 1..N Units (`unit.floor_id`) [Optional]
- Unit 1..N Leases (`lease.unit_id`)

### Ownership & Management Relationships

- Property Owner 1..N Portfolios (`portfolio.owner_id`)
- Property Owner 1..N Properties (`property.owner_id`)
- Portfolio Manager N..M Portfolios via `user_portfolio_assignments`
- Property Manager N..M Properties via `user_property_assignments`

### Tenant & Lease Relationships

- Tenant 1..N Leases (`lease.tenant_id`)
- Tenant 1..N Payments (`payment.tenant_id`)
- Tenant 1..N Maintenance Requests (`maintenance_request.tenant_id`)
- Lease 1..N Payments (`payment.lease_id`)
- Lease 0..N Lease Amendments (`lease_amendment.lease_id`) [Later]

### Maintenance Relationships

- Maintenance Request 0..1 Work Order (`work_order.maintenance_request_id`)
- Property 1..N Maintenance Requests (`maintenance_request.property_id`)
- Property 1..N Work Orders (`work_order.property_id`)
- Unit 0..N Maintenance Requests (`maintenance_request.unit_id`)
- Unit 0..N Work Orders (`work_order.unit_id`)
- Tenant 0..N Work Orders (`work_order.tenant_id`)
- Vendor 1..N Work Orders (`work_order.assigned_to_vendor_id`)
- User (Technician) 0..N Work Orders (`work_order.assigned_to_user_id`)

### User & Access Control Relationships

- User N..M Roles via `user_roles` (join table: user_id, role_id)
- Role N..M Permissions via `role_permissions` (join table: role_id, permission_id)
- User N..M Properties via `user_property_assignments` (join table: user_id, property_id, access_level)
- User N..M Portfolios via `user_portfolio_assignments` (join table: user_id, portfolio_id, access_level)

### Document Relationships

- Document belongs to entity via polymorphic: `entity_type` + `entity_id`
- Property 0..N Documents (`document.entity_type='property'`, `document.entity_id`)
- Unit 0..N Documents (`document.entity_type='unit'`, `document.entity_id`)
- Lease 0..N Documents (`document.entity_type='lease'`, `document.entity_id`)
- Tenant 0..N Documents (`document.entity_type='tenant'`, `document.entity_id`)
- Work Order 0..N Documents (`document.entity_type='work_order'`, `document.entity_id`)

### Entity Media Relationships

- Entity Media belongs to entity via polymorphic: `entity_type` + `entity_id`
- Entity Media 0..1 Document (`entity_media.document_id`) - Optional link to documents table
- Property 0..N Entity Media (`entity_media.entity_type='property'`, `entity_media.entity_id`)
- Unit 0..N Entity Media (`entity_media.entity_type='unit'`, `entity_media.entity_id`)
- Lease 0..N Entity Media (`entity_media.entity_type='lease'`, `entity_media.entity_id`)
- Tenant 0..N Entity Media (`entity_media.entity_type='tenant'`, `entity_media.entity_id`)
- Work Order 0..N Entity Media (`entity_media.entity_type='work_order'`, `entity_media.entity_id`)

### Notification Relationships

- User 0..N Notifications (`notification.user_id`)
- Tenant 0..N Notifications (`notification.tenant_id`)
- Lease 0..N Notifications (via metadata) - For lease-related notifications
- Payment 0..N Notifications (via metadata) - For payment-related notifications

### Audit Relationships

- User 0..N Audit Logs (`audit_log.user_id`)
- All entities 0..N Audit Logs (via `audit_log.entity_type` + `entity_id`)

### Sales & Visits Relationships

- Sales Rep 1..N Property Visits (`property_visit.sales_rep_id`)
- Client 1..N Property Visits (`property_visit.client_id`)
- Client 1..N Property Interests (`client_property_interest.client_id`)
- Property 1..N Property Visits (`property_visit.property_id`)
- Property 1..N Client Interests (`client_property_interest.property_id`)
- Sales Rep 1..N Leave Records (`sales_rep_leave.sales_rep_id`)

### Canteen Relationships

- Property 1..N Canteens (`canteen.property_id`)
- Canteen 1..N Agreements (`canteen_agreement.canteen_id`)
- Client 0..N Canteen Agreements (`canteen_agreement.client_id`)
- Tenant 0..N Canteen Agreements (`canteen_agreement.tenant_id`)

### Parking Relationships

- Property 1..N Parking Spaces (`parking_space.property_id`)
- Unit 0..N Parking Spaces (`parking_space.unit_id`)
- Client 0..N Parking Spaces (`parking_space.client_id`)
- Owner 0..N Parking Spaces (`parking_space.owner_id`)

### Optional/Advanced (Later)

- Work Order N..M Assets/Equipment (not in MVP)
- Unit N..M Parking Spaces (`parking_space_assignment`) [Later]
- Unit N..M Storage Units (`storage_unit_assignment`) [Later]

## 3) MVP Workflows (steps & roles)

### A) Tenant Onboarding

**Roles:** Tenant, Property Manager

**Steps:**

1. Tenant submits application (contact + basic info)
2. (Optional) Screening/background check
3. Property Manager reviews/approves
4. Create lease (draft) and send for e-sign
5. Tenant signs, lease becomes active; tenant account created

### B) Rent Payment

**Roles:** Tenant, Payment Processor, Accounting/PM

**Steps:**

1. System generates charge/invoice from lease terms
2. Tenant pays via portal (card/ACH) or records offline payment
3. Payment status updated (paid/failed); receipt issued
4. Reconcile payment to lease/accounting records

### C) Maintenance Request → Work Order

**Roles:** Tenant, Property Manager, Maintenance Coordinator/Technician/Vendor

**Steps:**

1. Tenant submits maintenance request (priority, description, photos)
2. PM/Coordinator triages and assigns (technician or vendor)
3. Assignee updates status/progress; uploads photos/notes
4. Completion logged; tenant notified; request closed

### D) Lease Creation/Renewal

**Roles:** Property Manager, Tenant

**Steps:**

1. PM drafts lease (terms, rent, dates, deposit)
2. Send for e-sign; Tenant signs
3. Lease activated; billing schedule set
4. For renewal: generate renewal offer, capture acceptance, update dates/rent

### E) Property/Unit Setup

**Roles:** Property Manager, Admin, Portfolio Manager

**Steps:**

1. Create property (address, type, status, ownership)
2. Assign property to portfolio
3. Assign property to Property Manager(s) for access control
4. Add units (type, size, rent, status)
5. Attach documents/photos/plans
6. Set up property-level settings and preferences

### F) Maintenance Request → Work Order Flow

**Roles:** Tenant, Property Manager, Maintenance Coordinator, Technician/Vendor

**Steps:**

1. Tenant submits Maintenance Request (priority, description, photos)
2. System creates Maintenance Request record
3. Property Manager/Maintenance Coordinator reviews request
4. Coordinator creates Work Order from request (or assigns request directly)
5. Work Order assigned to Technician (internal) or Vendor (external)
6. Assignee updates Work Order status and uploads documentation
7. Work Order marked completed; Maintenance Request closed
8. Tenant notified of completion; can provide feedback
9. Invoice generated from Work Order (if vendor)
10. Payment processed to vendor

## Data Model Summary

### Core Entities: 9

- Portfolio, Property, Unit, Tenant, Lease, Payment, Work Order, User, Role

### Supporting Entities: 9

- Organization/Company (Multi-tenant support)
- Maintenance Request (Separate from Work Order)
- Vendor/Contractor (External service providers)
- Document (File storage with polymorphic relationships)
- Entity Media (Image/media management with ordering and thumbnail support)
- Notification (System notifications)
- Permission (RBAC permissions)
- Audit Log (Change tracking)
- User-Property Assignment (Access control)

### Key Features

- Multi-tenant architecture with `organization_id` isolation
- Comprehensive audit trails (`created_by`, `updated_by`, `deleted_at`)
- Soft delete support across all entities
- Role-based access control with granular permissions
- Document management with version control
- Complete workflow support for maintenance and leasing

**Total Entities:** 26 (9 Core + 9 Supporting + 8 New)

**New Entities Added:**
- Sales Representative
- Property Visit
- Sales Rep Leave
- Client Property Interest
- Canteen
- Canteen Agreement
- Parking Space (enhanced with client/owner assignment)

**Total Relationships:** 40+ documented relationships

